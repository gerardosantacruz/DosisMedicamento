<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Control de Fiebre y Medicaci√≥n Pedi√°trica</title>
<style>
:root {
  --color-bg: #f9fafb;
  --color-card: #ffffff;
  --color-text: #111827;
  --color-muted: #6b7280;
  --color-primary: #2563eb;
  --color-success: #16a34a;
  --color-warning: #facc15;
  --color-danger: #dc2626;
  --color-border: #e5e7eb;
}
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: var(--color-bg);
  color: var(--color-text);
}
header {
  padding: 10px;
  background: var(--color-primary);
  color: white;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
header select, header button {
  padding: 5px;
  border-radius: 5px;
  border: none;
}
.container { padding: 10px; }
.card {
  background: var(--color-card);
  border: 1px solid var(--color-border);
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 15px;
}
label { display: block; margin-top: 10px; font-size: 0.9rem; }
input, select, button, textarea {
  width: 100%;
  padding: 8px;
  margin-top: 4px;
  border-radius: 8px;
  border: 1px solid var(--color-border);
  font-size: 1rem;
}
button {
  background: var(--color-primary);
  color: white;
  font-weight: bold;
  border: none;
  cursor: pointer;
}
button.danger { background: var(--color-danger); }
button.success { background: var(--color-success); }
.tabs {
  position: fixed;
  bottom: 0;
  left: 0; right: 0;
  display: flex;
  background: var(--color-card);
  border-top: 1px solid var(--color-border);
}
.tabs button {
  flex: 1;
  padding: 10px;
  background: none;
  border: none;
  font-size: 0.9rem;
}
.tabs button.active {
  background: var(--color-primary);
  color: white;
}
.section { display: none; }
.section.active { display: block; }
.history-item {
  border-bottom: 1px solid var(--color-border);
  padding: 5px;
  border-radius: 5px;
  margin-bottom: 5px;
}
.chart-container { position: relative; height: 200px; }
.temp-normal { background-color: var(--color-success); color: white; }
.temp-febr { background-color: var(--color-warning); }
.temp-fever { background-color: var(--color-danger); color: white; }
</style>
</head>
<body>
<header>
  <div><strong>Control Pedi√°trico</strong></div>
  <div>
    <select id="childSelect"></select>
    <button id="manageChildrenBtn">üë§</button>
  </div>
</header>

<div class="container">

  <!-- Calculadora -->
  <div class="section" id="calcSection">
    <div class="card">
      <h3>Calculadora de dosis</h3>
      <label>Peso (kg)</label>
      <input type="number" id="weightInput" step="0.1">
      <label>Medicamento</label>
      <select id="medType">
        <option value="Paracetamol">Paracetamol</option>
        <option value="Ibuprofeno">Ibuprofeno</option>
      </select>
      <label>Concentraci√≥n</label>
      <input type="number" id="concMg" placeholder="mg">
      <input type="number" id="concMl" placeholder="ml">
      <button id="calcDoseBtn">Calcular</button>
      <div id="doseResult"></div>
      <button id="saveDoseBtn" class="success">Registrar dosis</button>
    </div>
  </div>

  <!-- Planificador -->
  <div class="section" id="planSection">
    <div class="card">
      <h3>Planificador de tomas</h3>
      <label>Hora de inicio</label>
      <input type="time" id="planStart">
      <label>Intervalo (horas)</label>
      <input type="number" id="planInterval" value="6">
      <button id="genPlanBtn">Generar plan</button>
      <div id="planOutput"></div>
    </div>
  </div>

  <!-- Temperatura -->
  <div class="section" id="tempSection">
    <div class="card">
      <h3>Registro de temperatura</h3>
      <label>Temperatura (¬∞C)</label>
      <input type="number" id="tempValue" step="0.1">
      <label>Comentario</label>
      <textarea id="tempComment"></textarea>
      <button id="saveTempBtn" class="success">Guardar</button>
    </div>
    <div class="card">
      <h4>Evoluci√≥n</h4>
      <div class="chart-container">
        <canvas id="tempChart"></canvas>
      </div>
    </div>
    <div class="card" id="tempHistory"></div>
  </div>

  <!-- Historial Medicaci√≥n -->
  <div class="section" id="medHistorySection">
    <div class="card" id="medHistory"></div>
  </div>

  <!-- Configuraci√≥n -->
  <div class="section" id="configSection">
    <div class="card">
      <h3>Configuraci√≥n del hijo</h3>
      <label>Nombre</label>
      <input type="text" id="childName">
      <label>Peso (kg)</label>
      <input type="number" id="childWeight" step="0.1">
      <button id="saveChildBtn" class="success">Guardar</button>
      <button id="deleteChildBtn" class="danger">Eliminar hijo</button>
    </div>
  </div>

</div>

<div class="tabs">
  <button data-section="calcSection" class="active">Calculadora</button>
  <button data-section="planSection">Planificador</button>
  <button data-section="tempSection">Temperatura</button>
  <button data-section="medHistorySection">Historial Med.</button>
  <button data-section="configSection">Config.</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let data = JSON.parse(localStorage.getItem("pediatricAppData") || "{}");
if (!data.children) data.children = {};
let currentChildId = null;
function saveData() { localStorage.setItem("pediatricAppData", JSON.stringify(data)); }
function genId() { return "id" + Date.now() + Math.random().toString(16).slice(2); }
function formatDateTime(ts) { return new Date(ts).toLocaleString(); }
function tempClass(temp){
  if(temp < 37.5) return "temp-normal";
  if(temp < 38) return "temp-febr";
  return "temp-fever";
}
function tempColor(temp){
  if(temp < 37.5) return "green";
  if(temp < 38) return "yellow";
  return "red";
}
function ensureExampleChild(){
  if(Object.keys(data.children).length===0){
    const id = genId();
    data.children[id]={name:"Ejemplo",weight:12,doses:[],temps:[]};
    currentChildId = id; saveData();
  }
}
ensureExampleChild();
const childSelect = document.getElementById("childSelect");
function refreshChildSelect(){
  childSelect.innerHTML="";
  for(let id in data.children){
    const opt=document.createElement("option");
    opt.value=id; opt.textContent=data.children[id].name;
    childSelect.appendChild(opt);
  }
  if(!currentChildId) currentChildId=Object.keys(data.children)[0];
  childSelect.value=currentChildId;
}
refreshChildSelect();
childSelect.addEventListener("change",()=>{
  currentChildId=childSelect.value;
  loadChildConfig(); refreshHistories(); drawTempChart();
});
document.querySelectorAll(".tabs button").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    document.querySelectorAll(".section").forEach(sec=>sec.classList.remove("active"));
    document.getElementById(btn.dataset.section).classList.add("active");
    if(btn.dataset.section==="tempSection") drawTempChart();
  });
});
function loadChildConfig(){
  if(!currentChildId) return;
  const c=data.children[currentChildId];
  document.getElementById("childName").value=c.name||"";
  document.getElementById("childWeight").value=c.weight||"";
}
loadChildConfig();
document.getElementById("saveChildBtn").addEventListener("click",()=>{
  if(!currentChildId){
    currentChildId=genId();
    data.children[currentChildId]={name:"",weight:0,doses:[],temps:[]};
  }
  const c=data.children[currentChildId];
  c.name=document.getElementById("childName").value;
  c.weight=parseFloat(document.getElementById("childWeight").value)||0;
  saveData(); refreshChildSelect(); alert("Datos guardados");
});
document.getElementById("deleteChildBtn").addEventListener("click",()=>{
  if(confirm("¬øEliminar este hijo?")){
    delete data.children[currentChildId]; currentChildId=null;
    saveData(); ensureExampleChild(); refreshChildSelect(); loadChildConfig(); refreshHistories();
  }
});
document.getElementById("calcDoseBtn").addEventListener("click",()=>{
  const weight=parseFloat(document.getElementById("weightInput").value)||
    data.children[currentChildId].weight;
  const med=document.getElementById("medType").value;
  const mg=parseFloat(document.getElementById("concMg").value);
  const ml=parseFloat(document.getElementById("concMl").value);
  if(!weight||!mg||!ml){alert("Complete peso y concentraci√≥n");return;}
  const mgPerMl=mg/ml;
  let minMg,maxMg;
  if(med==="Paracetamol"){minMg=weight*10;maxMg=weight*15;} else {minMg=maxMg=weight*10;}
  const minMl=minMg/mgPerMl; const maxMl=maxMg/mgPerMl;
  document.getElementById("doseResult").textContent=`${minMg.toFixed(0)}‚Äì${maxMg.toFixed(0)} mg = ${minMl.toFixed(1)}‚Äì${maxMl.toFixed(1)} ml`;
});
document.getElementById("saveDoseBtn").addEventListener("click",()=>{
  const res=document.getElementById("doseResult").textContent;
  if(!res){alert("Primero calcule la dosis");return;}
  data.children[currentChildId].doses.unshift({time:Date.now(),info:res});
  saveData(); refreshHistories();
});
document.getElementById("genPlanBtn").addEventListener("click",()=>{
  const start=document.getElementById("planStart").value;
  const intv=parseInt(document.getElementById("planInterval").value);
  if(!start||!intv){alert("Complete hora e intervalo");return;}
  const [h,m]=start.split(":").map(Number);
  const out=[]; let t=new Date(); t.setHours(h,m,0,0);
  for(let i=0;i<24;i+=intv){
    out.push(t.toLocaleTimeString([], {hour:"2-digit",minute:"2-digit"}));
    t.setHours(t.getHours()+intv);
  }
  document.getElementById("planOutput").innerHTML=out.join("<br>");
});
document.getElementById("saveTempBtn").addEventListener("click",()=>{
  const val=parseFloat(document.getElementById("tempValue").value);
  const com=document.getElementById("tempComment").value;
  if(!val){alert("Ingrese la temperatura");return;}
  data.children[currentChildId].temps.unshift({time:Date.now(),value:val,comment:com});
  saveData();
  document.getElementById("tempValue").value=""; document.getElementById("tempComment").value="";
  refreshHistories(); drawTempChart();
});
function refreshHistories(){
  const medHistDiv=document.getElementById("medHistory");
  medHistDiv.innerHTML="<h3>Historial de medicaci√≥n</h3>";
  data.children[currentChildId].doses.forEach(d=>{
    const div=document.createElement("div");
    div.className="history-item";
    div.textContent=`${formatDateTime(d.time)} - ${d.info}`;
    medHistDiv.appendChild(div);
  });
  const tempHistDiv=document.getElementById("tempHistory");
  tempHistDiv.innerHTML="<h3>Historial de temperatura</h3>";
  data.children[currentChildId].temps.forEach(t=>{
    const div=document.createElement("div");
    div.className=`history-item ${tempClass(t.value)}`;
    div.textContent=`${formatDateTime(t.time)} - ${t.value}¬∞C - ${t.comment||""}`;
    tempHistDiv.appendChild(div);
  });
}
refreshHistories();
let tempChart;
function drawTempChart(){
  const ctx=document.getElementById("tempChart").getContext("2d");
  const temps=data.children[currentChildId].temps.slice().reverse();
  const labels=temps.map(t=>new Date(t.time).toLocaleTimeString([], {hour:"2-digit",minute:"2-digit"}));
  const values=temps.map(t=>t.value);
  const colors=temps.map(t=>tempColor(t.value));
  if(tempChart) tempChart.destroy();
  tempChart=new Chart(ctx,{
    type:'line',
    data:{
      labels:labels,
      datasets:[{
        label:'Temperatura ¬∞C',
        data:values,
        borderColor:'black',
        pointBackgroundColor:colors,
        backgroundColor:'rgba(0,0,0,0.05)'
      }]
    },
    options:{responsive:true,scales:{y:{beginAtZero:false}}}
  });
}
</script>
</body>
</html>
